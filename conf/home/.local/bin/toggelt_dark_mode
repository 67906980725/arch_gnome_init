#!/usr/bin/env bash


prefer_dark_name="prefer-dark"
prefer_light_name="default"
gnome_shell_dark_name="Orchis-Dark-Compact"
gnome_shell_light_name="Orchis-Light-Compact"
gtk2_dark_name="Adwaita-dark"
gtk2_light_name="Adwaita"

code_dark_name="Default\ Dark+"
code_light_name="Default\ Light+"
fcitx5_dark_name="Alpha-black-2.0"
fcitx5_light_name="珍珠白"


full_dark()
{   
    # 如果方法调用时有传参并且当前color-scheme是$prefer_dark_name时就不再设置主题了
    if [ "$1" != "" ] && [ "$(gsettings get org.gnome.desktop.interface color-scheme)" = "'$prefer_dark_name'" ]; then
        return 0
    fi
    dark
    code_Dark
    fcitx5_Dark
    restarts
}
full_light()
{
    if [ "$1" != "" ] && [ "$(gsettings get org.gnome.desktop.interface color-scheme)" = "'$prefer_light_name'" ]; then
        return 0
    fi
    light
    code_light
    fcitx5_light
    restarts
}

dark()
{
    gsettings set org.gnome.desktop.interface color-scheme "$prefer_dark_name"
    gsettings set org.gnome.shell.extensions.user-theme name "$gnome_shell_dark_name"
    gsettings set org.gnome.desktop.interface gtk-theme "$gtk2_dark_name"
}
light()
{
    gsettings set org.gnome.desktop.interface color-scheme "$prefer_light_name"
    gsettings set org.gnome.shell.extensions.user-theme name "$gnome_shell_light_name"
    gsettings set org.gnome.desktop.interface gtk-theme "$gtk2_light_name"
}
code_Dark()
{
    sed -i "/workbench.colorTheme/s/$code_light_name/$code_dark_name/" "$HOME/.config/Code - OSS/User/settings.json"
}
code_light()
{
    sed -i "/workbench.colorTheme/s/$code_dark_name/$code_light_name/" "$HOME/.config/Code - OSS/User/settings.json"
}
fcitx5_Dark()
{
    sed -i "/Theme=/s/$fcitx5_light_name/$fcitx5_dark_name/" "$HOME/.config/fcitx5/conf/classicui.conf"
}
fcitx5_light()
{
    sed -i "/Theme=/s/$fcitx5_dark_name/$fcitx5_light_name/" "$HOME/.config/fcitx5/conf/classicui.conf"
}
restarts()
{
    notify-send "即将重启: QQ"
    sleep 10
    $HOME/.local/bin/k qq
    gtk-launch qq
}

toggelt()
{
    mode="$(gsettings get org.gnome.desktop.interface color-scheme)"
    if [ "$mode" = "'$prefer_dark_name'" ]; then
        full_light
    else
        full_dark
    fi
}


case $1 in
    dark) full_dark $2;;
    light) full_light $2;;
    *) toggelt ;;
esac
